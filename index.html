<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>StepOut Daily — Walk More, Live Longer</title>
  <meta name="description" content="A longevity-focused walking and wellness app. Schedule walks, track streaks, and build habits that add years to your life." />
  <meta name="theme-color" content="#0a160a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="StepOut Daily" />

  <!-- Open Graph -->
  <meta property="og:title" content="StepOut Daily — Walk More, Live Longer" />
  <meta property="og:description" content="A longevity-focused walking and wellness app." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://stepoutdaily.com" />

  <!-- PWA Manifest (inline via data URI) -->
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU3RlcE91dCBEYWlseSIsInNob3J0X25hbWUiOiJTdGVwT3V0Iiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTE2MGEiLCJ0aGVtZV9jb2xvciI6IiMwYTE2MGEiLCJpY29ucyI6W119" />

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js" crossorigin></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js" crossorigin></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js" crossorigin></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background: #0a160a; overflow-x: hidden; }
    html { scroll-behavior: smooth; }
    ::-webkit-scrollbar { display: none; }
    input { font-family: inherit; }
    input::placeholder { color: #5a6a50; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    // ── Firebase Init ──
    var auth = null;
    var db = null;
    var firebaseReady = false;
    try {
      if (typeof firebase !== 'undefined') {
        firebase.initializeApp({
          apiKey: "AIzaSyCT29XI6HCOmw5n7rn1i0oJ2rSJ_f4zW6I",
          authDomain: "stepout-daily.firebaseapp.com",
          projectId: "stepout-daily",
          storageBucket: "stepout-daily.firebasestorage.app",
          messagingSenderId: "817332362346",
          appId: "1:817332362346:web:99264c2ab36ebf36817e13"
        });
        auth = firebase.auth();
        db = firebase.firestore();
        firebaseReady = true;
        console.log("Firebase initialized successfully");
      }
    } catch(e) {
      console.log("Firebase init error - running in offline mode:", e.message);
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    /* ═══════════════════════════════════════════
       DATA
    ═══════════════════════════════════════════ */
    const DAYS = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    const FULL_DAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    const INDOOR_ACTIVITIES = [
      { name: "Squat & Breathe Circuit", howTo: "Do 3 rounds of: 10 air squats (sit back like into an invisible chair, stand back up), then 1 minute of slow deep breathing. Rest 30 seconds between rounds. Finish with 2 minutes of gentle marching in place to cool down.", tip: "Squats strengthen the muscles that keep you mobile and independent as you age. Pairing them with breathwork lowers your heart rate and builds recovery capacity.", duration: "10 min", icon: "\u{1F9B5}" },
      { name: "Wall Push-up & Hold Routine", howTo: "Do 3 rounds of: 10 wall push-ups (stand arm's length from a wall, lean in and push back), then hold a wall plank (lean toward the wall with arms straight) for 30 seconds. Rest 45 seconds between rounds. Finish with 2 minutes of gentle shoulder rolls and arm circles.", tip: "Upper body strength is linked to lower all-cause mortality. Short routines done consistently beat occasional intense workouts.", duration: "10 min", icon: "\u{1F4AA}" },
      { name: "Balance & Mobility Flow", howTo: "Start with 60 seconds balancing on each foot (hold a counter for safety). Then do 10 slow leg swings on each side. Repeat the balance holds for 60 seconds each. Finish with 3 minutes of slow walking in a figure-eight pattern around your room, focusing on smooth heel-to-toe steps.", tip: "The ability to stand on one leg for 10+ seconds is strongly correlated with longevity in adults over 50. Practicing balance daily can dramatically reduce fall risk.", duration: "10 min", icon: "\u{1F9D8}" },
      { name: "Sit-to-Stand Challenge", howTo: "Sit in a sturdy chair with arms crossed over your chest. Stand all the way up, then sit back down \u2014 that's one rep. Do 10 reps, rest 1 minute. Repeat for 4 rounds total. Between rounds, do gentle quad stretches.", tip: "How many times you can stand from a chair in 30 seconds predicts your functional fitness for the next decade.", duration: "10 min", icon: "\u{1FA91}" },
      { name: "Grip & Hang Practice", howTo: "Find a sturdy door frame or overhead ledge. Hang with both hands for as long as you can (even 10 seconds is great), then rest 1 minute. Do 5 rounds. Between hangs, squeeze a rolled-up towel as hard as you can for 20 seconds with each hand.", tip: "Grip strength is one of the strongest predictors of longevity. Doctors increasingly use it as a quick health screening tool.", duration: "10 min", icon: "\u{1F932}" },
      { name: "Lunge & Walk Circuit", howTo: "Do 5 walking lunges on each leg. Then walk around the room at a brisk pace for 2 minutes. Repeat this cycle 3 times. Hold onto a wall during lunges if you need balance support.", tip: "Single-leg exercises improve balance and prevent falls \u2014 the #1 cause of injury-related death in older adults.", duration: "10 min", icon: "\u{1F6B6}" },
      { name: "Guided Breathwork Session", howTo: "Sit or lie down comfortably. Round 1 (3 min): Box breathing \u2014 breathe in 4 seconds, hold 4, out 4, hold 4. Round 2 (3 min): Extended exhale \u2014 breathe in 4 seconds, out 8 seconds. Round 3 (3 min): Natural breathing with eyes closed.", tip: "Controlled breathing activates your parasympathetic nervous system, lowering cortisol and inflammation.", duration: "10 min", icon: "\u{1F32C}\u{FE0F}" },
      { name: "Calf Raise & March Combo", howTo: "Stand behind a chair for balance. Do 20 calf raises (rise onto tiptoes, pause, lower slowly). Then march in place with high knees for 1 minute. Repeat this cycle 4 times.", tip: "Calf muscles act as a 'second heart,' pumping blood back up from your legs. Strong calves = better circulation.", duration: "10 min", icon: "\u{1F9B6}" },
    ];

    const LONGEVITY_QUOTES = [
      "Walking 22 minutes a day can offset the health risks of prolonged sitting.",
      "Adults who walk briskly for 30 min/day have a biological age 9 years younger.",
      "Morning sunlight exposure helps regulate cortisol and improves sleep quality.",
      "Even a 10-minute walk after meals significantly improves blood sugar regulation.",
      "People who spend 120+ minutes per week in nature report significantly better health.",
    ];

    const STREAK_MESSAGES = [
      { min: 0, max: 0, msg: "Today's a fresh start. One step at a time." },
      { min: 1, max: 2, msg: "You're building momentum \u2014 keep it going!" },
      { min: 3, max: 6, msg: "You're on a roll! Consistency is the real superpower." },
      { min: 7, max: 13, msg: "A full week! You're building a habit that adds years to your life." },
      { min: 14, max: 29, msg: "Two weeks strong. Your body is already adapting and thanking you." },
      { min: 30, max: 999, msg: "A month of daily movement. You're not just exercising \u2014 you're extending your life." },
    ];

    const HEALTH_MILESTONES = [
      { mins: 0, label: "Get moving to unlock your first milestone!" },
      { mins: 60, label: "60 min/week \u2014 your mood and sleep are already improving" },
      { mins: 90, label: "90 min/week \u2014 linked to 30% lower heart disease risk" },
      { mins: 150, label: "150 min/week \u2014 you've hit the WHO recommended activity level!" },
      { mins: 200, label: "200 min/week \u2014 associated with significantly lower cancer risk" },
      { mins: 300, label: "300+ min/week \u2014 maximum longevity benefits. You're in the top tier." },
    ];

    function getRandomActivity() {
      return INDOOR_ACTIVITIES[Math.floor(Math.random() * INDOOR_ACTIVITIES.length)];
    }

    /* ═══════════════════════════════════════════
       FIRESTORE HELPERS
    ═══════════════════════════════════════════ */
    async function saveUserData(userId, data) {
      if (!firebaseReady || !db) return;
      try {
        await db.collection('users').doc(userId).set(data, { merge: true });
      } catch(e) { console.log("Firestore save error:", e.message); }
    }

    async function loadUserData(userId) {
      if (!firebaseReady || !db) return null;
      try {
        const doc = await db.collection('users').doc(userId).get();
        return doc.exists ? doc.data() : null;
      } catch(e) { console.log("Firestore load error:", e.message); return null; }
    }

    /* ═══════════════════════════════════════════
       NOAA WEATHER API
    ═══════════════════════════════════════════ */
    async function fetchWeather(lat, lon) {
      try {
        const pointRes = await fetch(`https://api.weather.gov/points/${lat},${lon}`, {
          headers: { 'User-Agent': 'StepOutDaily/1.0 (contact@stepoutdaily.com)' }
        });
        const pointData = await pointRes.json();
        const forecastUrl = pointData.properties.forecast;
        const hourlyUrl = pointData.properties.forecastHourly;

        const [forecastRes, hourlyRes] = await Promise.all([
          fetch(forecastUrl, { headers: { 'User-Agent': 'StepOutDaily/1.0' } }),
          fetch(hourlyUrl, { headers: { 'User-Agent': 'StepOutDaily/1.0' } })
        ]);
        const forecastData = await forecastRes.json();
        const hourlyData = await hourlyRes.json();
        return { forecast: forecastData, hourly: hourlyData };
      } catch(e) {
        console.log("Weather fetch error:", e.message);
        return null;
      }
    }

    function getWeatherIcon(shortForecast) {
      const f = (shortForecast || "").toLowerCase();
      if (f.includes("thunder")) return "\u26C8\uFE0F";
      if (f.includes("rain") || f.includes("shower")) return "\u{1F327}\uFE0F";
      if (f.includes("snow")) return "\u{1F328}\uFE0F";
      if (f.includes("cloud") && f.includes("partly")) return "\u26C5";
      if (f.includes("cloud") || f.includes("overcast")) return "\u2601\uFE0F";
      if (f.includes("fog")) return "\u{1F32B}\uFE0F";
      if (f.includes("wind")) return "\u{1F32C}\uFE0F";
      return "\u2600\uFE0F";
    }

    function isGoodWeather(shortForecast) {
      const f = (shortForecast || "").toLowerCase();
      return !f.includes("thunder") && !f.includes("heavy rain") && !f.includes("snow") && !f.includes("storm");
    }

    /* ═══════════════════════════════════════════
       WELCOME / AUTH SCREEN
    ═══════════════════════════════════════════ */
    function WelcomeScreen({ onLogin }) {
      const [mode, setMode] = useState("welcome"); // welcome, login, signup
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [name, setName] = useState("");
      const [error, setError] = useState("");
      const [loading, setLoading] = useState(false);

      const inputStyle = {
        width: "100%", padding: "14px 16px", borderRadius: 12,
        background: "rgba(255,255,255,0.06)", border: "1px solid rgba(255,255,255,0.12)",
        color: "#e8efe4", fontSize: 15, fontFamily: "inherit", outline: "none",
        marginBottom: 12,
      };

      const primaryBtn = {
        width: "100%", padding: "16px 0", borderRadius: 14, border: "none",
        background: "linear-gradient(135deg, #86c26c 0%, #6ba352 100%)",
        color: "#0a160a", fontSize: 16, fontWeight: 700, cursor: "pointer",
        fontFamily: "inherit", boxShadow: "0 4px 24px rgba(134,194,108,0.3)",
        marginBottom: 12,
      };

      const googleBtn = {
        width: "100%", padding: "16px 0", borderRadius: 14, cursor: "pointer",
        background: "rgba(255,255,255,0.06)", border: "1px solid rgba(255,255,255,0.15)",
        color: "#e8efe4", fontSize: 15, fontWeight: 600, fontFamily: "inherit",
        display: "flex", alignItems: "center", justifyContent: "center", gap: 10,
        marginBottom: 12,
      };

      async function handleGoogleSignIn() {
        setError("");
        setLoading(true);
        if (firebaseReady && auth) {
          try {
            const provider = new firebase.auth.GoogleAuthProvider();
            const result = await auth.signInWithPopup(provider);
            onLogin({ uid: result.user.uid, email: result.user.email, name: result.user.displayName, provider: "google" });
          } catch(e) {
            setError(e.message);
            setLoading(false);
          }
        } else {
          // Offline fallback
          const offlineUser = { uid: "offline_" + Date.now(), email: "guest@stepoutdaily.com", name: "Guest User", provider: "offline" };
          localStorage.setItem("stepout_user", JSON.stringify(offlineUser));
          onLogin(offlineUser);
        }
      }

      async function handleEmailSignUp() {
        if (!email || !password) { setError("Please enter email and password"); return; }
        if (password.length < 6) { setError("Password must be at least 6 characters"); return; }
        setError("");
        setLoading(true);
        if (firebaseReady && auth) {
          try {
            const result = await auth.createUserWithEmailAndPassword(email, password);
            if (name) await result.user.updateProfile({ displayName: name });
            onLogin({ uid: result.user.uid, email: result.user.email, name: name || email, provider: "email" });
          } catch(e) {
            setError(e.code === "auth/email-already-in-use" ? "An account with this email already exists. Try signing in instead." : e.message);
            setLoading(false);
          }
        } else {
          const offlineUser = { uid: "offline_" + Date.now(), email: email, name: name || email, provider: "offline" };
          localStorage.setItem("stepout_user", JSON.stringify(offlineUser));
          onLogin(offlineUser);
        }
      }

      async function handleEmailSignIn() {
        if (!email || !password) { setError("Please enter email and password"); return; }
        setError("");
        setLoading(true);
        if (firebaseReady && auth) {
          try {
            const result = await auth.signInWithEmailAndPassword(email, password);
            onLogin({ uid: result.user.uid, email: result.user.email, name: result.user.displayName || email, provider: "email" });
          } catch(e) {
            setError(e.code === "auth/wrong-password" ? "Incorrect password. Please try again." : e.code === "auth/user-not-found" ? "No account found with this email. Try creating one." : e.message);
            setLoading(false);
          }
        } else {
          const offlineUser = { uid: "offline_" + Date.now(), email: email, name: email, provider: "offline" };
          localStorage.setItem("stepout_user", JSON.stringify(offlineUser));
          onLogin(offlineUser);
        }
      }

      // ── Welcome Screen ──
      if (mode === "welcome") {
        return (
          <div style={{
            maxWidth: 390, margin: "0 auto", minHeight: "100vh",
            background: "linear-gradient(170deg, #1a2e1a 0%, #0f1f0f 40%, #0a160a 100%)",
            fontFamily: "'Instrument Sans', 'Avenir Next', system-ui, sans-serif",
            color: "#e8efe4", display: "flex", flexDirection: "column", alignItems: "center",
            justifyContent: "center", padding: "40px 28px", position: "relative", overflow: "hidden",
          }}>
            <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet" />

            {/* Ambient glow */}
            <div style={{ position: "absolute", top: -80, right: -80, width: 260, height: 260, background: "radial-gradient(circle, rgba(134,194,108,0.15) 0%, transparent 70%)", borderRadius: "50%", pointerEvents: "none" }} />
            <div style={{ position: "absolute", bottom: 80, left: -60, width: 200, height: 200, background: "radial-gradient(circle, rgba(194,168,108,0.1) 0%, transparent 70%)", borderRadius: "50%", pointerEvents: "none" }} />

            {/* Logo area */}
            <div style={{ fontSize: 64, marginBottom: 16 }}>{"\u{1F6B6}\u200D\u2640\uFE0F"}</div>
            <h1 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 42, fontWeight: 700, margin: "0 0 4px", color: "#f0f7ec", textAlign: "center" }}>
              Step<span style={{ color: "#86c26c" }}>Out</span>
            </h1>
            <div style={{ fontSize: 16, color: "#86c26c", fontWeight: 600, letterSpacing: 2, textTransform: "uppercase", marginBottom: 8 }}>Daily</div>
            <div style={{ fontSize: 16, color: "#8a9a7e", textAlign: "center", lineHeight: 1.5, marginBottom: 40, maxWidth: 280 }}>
              Walk more. Live longer. Build daily habits that add years to your life.
            </div>

            {/* Google Sign In - Primary */}
            <button onClick={handleGoogleSignIn} disabled={loading} style={{...googleBtn, background: "rgba(255,255,255,0.08)", border: "1px solid rgba(255,255,255,0.2)"}}>
              <svg width="20" height="20" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
              Continue with Google
            </button>

            {/* Divider */}
            <div style={{ display: "flex", alignItems: "center", gap: 16, width: "100%", margin: "8px 0 20px" }}>
              <div style={{ flex: 1, height: 1, background: "rgba(255,255,255,0.1)" }} />
              <span style={{ fontSize: 12, color: "#5a6a50" }}>or</span>
              <div style={{ flex: 1, height: 1, background: "rgba(255,255,255,0.1)" }} />
            </div>

            {/* Create Account */}
            <button onClick={() => setMode("signup")} style={primaryBtn}>
              Create an Account
            </button>

            {/* Sign In link */}
            <button onClick={() => setMode("login")} style={{
              background: "none", border: "none", color: "#86c26c", fontSize: 14,
              fontWeight: 600, cursor: "pointer", fontFamily: "inherit", padding: "8px 0",
            }}>
              Already have an account? Sign In
            </button>

            {/* Terms */}
            <div style={{ fontSize: 11, color: "#4a5a40", textAlign: "center", marginTop: 24, lineHeight: 1.5, maxWidth: 280 }}>
              By continuing, you agree to our{" "}
              <a href="/terms" style={{ color: "#6b7a60", textDecoration: "underline" }}>Terms of Service</a>
              {" "}and{" "}
              <a href="/privacy" style={{ color: "#6b7a60", textDecoration: "underline" }}>Privacy Policy</a>
            </div>
          </div>
        );
      }

      // ── Sign Up Form ──
      if (mode === "signup") {
        return (
          <div style={{
            maxWidth: 390, margin: "0 auto", minHeight: "100vh",
            background: "linear-gradient(170deg, #1a2e1a 0%, #0f1f0f 40%, #0a160a 100%)",
            fontFamily: "'Instrument Sans', 'Avenir Next', system-ui, sans-serif",
            color: "#e8efe4", padding: "60px 28px", position: "relative",
          }}>
            <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet" />

            <button onClick={() => { setMode("welcome"); setError(""); }} style={{
              background: "none", border: "none", color: "#86c26c", fontSize: 14, fontWeight: 600,
              cursor: "pointer", fontFamily: "inherit", padding: 0, marginBottom: 32,
            }}>{"\u2190"} Back</button>

            <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 28, fontWeight: 700, color: "#f0f7ec", marginBottom: 6 }}>Create Your Account</h2>
            <p style={{ fontSize: 14, color: "#8a9a7e", marginBottom: 28 }}>Start your longevity journey today</p>

            <input type="text" placeholder="Your Name (optional)" value={name} onChange={e => setName(e.target.value)} style={inputStyle} />
            <input type="email" placeholder="Email Address" value={email} onChange={e => setEmail(e.target.value)} style={inputStyle} />
            <input type="password" placeholder="Password (6+ characters)" value={password} onChange={e => setPassword(e.target.value)} style={inputStyle} />

            {error && <div style={{ color: "#e07060", fontSize: 13, marginBottom: 12, padding: "10px 14px", background: "rgba(224,112,96,0.1)", borderRadius: 10 }}>{error}</div>}

            <button onClick={handleEmailSignUp} disabled={loading} style={{...primaryBtn, opacity: loading ? 0.6 : 1}}>
              {loading ? "Creating Account..." : "Create Account"}
            </button>

            {/* Google option */}
            <button onClick={handleGoogleSignIn} disabled={loading} style={googleBtn}>
              <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
              Or continue with Google
            </button>

            <button onClick={() => { setMode("login"); setError(""); }} style={{
              background: "none", border: "none", color: "#86c26c", fontSize: 14,
              fontWeight: 600, cursor: "pointer", fontFamily: "inherit", padding: "8px 0", width: "100%",
            }}>
              Already have an account? Sign In
            </button>
          </div>
        );
      }

      // ── Login Form ──
      return (
        <div style={{
          maxWidth: 390, margin: "0 auto", minHeight: "100vh",
          background: "linear-gradient(170deg, #1a2e1a 0%, #0f1f0f 40%, #0a160a 100%)",
          fontFamily: "'Instrument Sans', 'Avenir Next', system-ui, sans-serif",
          color: "#e8efe4", padding: "60px 28px", position: "relative",
        }}>
          <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet" />

          <button onClick={() => { setMode("welcome"); setError(""); }} style={{
            background: "none", border: "none", color: "#86c26c", fontSize: 14, fontWeight: 600,
            cursor: "pointer", fontFamily: "inherit", padding: 0, marginBottom: 32,
          }}>{"\u2190"} Back</button>

          <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 28, fontWeight: 700, color: "#f0f7ec", marginBottom: 6 }}>Welcome Back</h2>
          <p style={{ fontSize: 14, color: "#8a9a7e", marginBottom: 28 }}>Sign in to continue your streak</p>

          <input type="email" placeholder="Email Address" value={email} onChange={e => setEmail(e.target.value)} style={inputStyle} />
          <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} style={inputStyle} />

          {error && <div style={{ color: "#e07060", fontSize: 13, marginBottom: 12, padding: "10px 14px", background: "rgba(224,112,96,0.1)", borderRadius: 10 }}>{error}</div>}

          <button onClick={handleEmailSignIn} disabled={loading} style={{...primaryBtn, opacity: loading ? 0.6 : 1}}>
            {loading ? "Signing In..." : "Sign In"}
          </button>

          <button onClick={handleGoogleSignIn} disabled={loading} style={googleBtn}>
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
            Or continue with Google
          </button>

          <button onClick={() => { setMode("signup"); setError(""); }} style={{
            background: "none", border: "none", color: "#86c26c", fontSize: 14,
            fontWeight: 600, cursor: "pointer", fontFamily: "inherit", padding: "8px 0", width: "100%",
          }}>
            Don't have an account? Create One
          </button>
        </div>
      );
    }

    /* ═══════════════════════════════════════════
       ADD TO HOME SCREEN PROMPT
    ═══════════════════════════════════════════ */
    function InstallPrompt({ onDismiss }) {
      const [isIOS, setIsIOS] = useState(false);
      const [isAndroid, setIsAndroid] = useState(false);

      useEffect(() => {
        const ua = navigator.userAgent || "";
        setIsIOS(/iPad|iPhone|iPod/.test(ua));
        setIsAndroid(/Android/.test(ua));
      }, []);

      // Only show on mobile
      if (!isIOS && !isAndroid) return null;

      return (
        <div style={{
          position: "fixed", bottom: 0, left: "50%", transform: "translateX(-50%)",
          width: "100%", maxWidth: 390, zIndex: 1000,
          background: "linear-gradient(to top, #1a2e1a 80%, transparent)",
          padding: "40px 24px 32px",
        }}>
          <div style={{
            background: "rgba(134,194,108,0.1)", border: "1px solid rgba(134,194,108,0.25)",
            borderRadius: 20, padding: 20,
          }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 12 }}>
              <div style={{ fontSize: 13, fontWeight: 700, color: "#86c26c" }}>
                {"\u{1F4F1}"} Add StepOut to Your Home Screen
              </div>
              <button onClick={onDismiss} style={{
                background: "none", border: "none", color: "#5a6a50", fontSize: 18, cursor: "pointer", padding: 0, lineHeight: 1,
              }}>{"\u00D7"}</button>
            </div>

            {isIOS ? (
              <div style={{ fontSize: 13, color: "#a8c89a", lineHeight: 1.6 }}>
                <div style={{ marginBottom: 8 }}>
                  <strong style={{ color: "#e8efe4" }}>Step 1:</strong> Tap the Share button{" "}
                  <span style={{ fontSize: 16 }}>{"\u{1F4E4}"}</span> at the bottom of your screen
                </div>
                <div style={{ marginBottom: 8 }}>
                  <strong style={{ color: "#e8efe4" }}>Step 2:</strong> Scroll down and tap <strong style={{ color: "#e8efe4" }}>"Add to Home Screen"</strong>
                </div>
                <div>
                  <strong style={{ color: "#e8efe4" }}>Step 3:</strong> Tap <strong style={{ color: "#e8efe4" }}>"Add"</strong> in the top right corner
                </div>
              </div>
            ) : (
              <div style={{ fontSize: 13, color: "#a8c89a", lineHeight: 1.6 }}>
                <div style={{ marginBottom: 8 }}>
                  <strong style={{ color: "#e8efe4" }}>Step 1:</strong> Tap the menu{" "}
                  <span style={{ fontSize: 14 }}>{"\u22EE"}</span> (three dots) in the top right corner
                </div>
                <div style={{ marginBottom: 8 }}>
                  <strong style={{ color: "#e8efe4" }}>Step 2:</strong> Tap <strong style={{ color: "#e8efe4" }}>"Add to Home screen"</strong> or <strong style={{ color: "#e8efe4" }}>"Install app"</strong>
                </div>
                <div>
                  <strong style={{ color: "#e8efe4" }}>Step 3:</strong> Tap <strong style={{ color: "#e8efe4" }}>"Add"</strong> to confirm
                </div>
              </div>
            )}

            <div style={{ fontSize: 11, color: "#5a6a50", marginTop: 12 }}>
              This lets you open StepOut Daily like a regular app!
            </div>
          </div>
        </div>
      );
    }

    /* ═══════════════════════════════════════════
       MAIN APP (after login)
    ═══════════════════════════════════════════ */
    function StepOutApp({ user, onLogout }) {
      const today = new Date();
      const todayIdx = today.getDay();
      const dayName = FULL_DAYS[todayIdx];
      const dateStr = today.toLocaleDateString("en-US", { month: "long", day: "numeric" });

      const [screen, setScreen] = useState("home");
      const [duration, setDuration] = useState(30);
      const [selectedSlot, setSelectedSlot] = useState(null);
      const [confirmed, setConfirmed] = useState(false);
      const [indoorActivity, setIndoorActivity] = useState(getRandomActivity());
      const [showSettings, setShowSettings] = useState(false);
      const [fadeIn, setFadeIn] = useState(true);
      const [dailyQuote] = useState(LONGEVITY_QUOTES[Math.floor(Math.random() * LONGEVITY_QUOTES.length)]);
      const [showInstall, setShowInstall] = useState(false);
      const [showProfile, setShowProfile] = useState(false);

      // Streak & progress
      const [streak, setStreak] = useState(0);
      const [weekLog, setWeekLog] = useState({});
      const [weeklyMins, setWeeklyMins] = useState(0);
      const [missedWalk, setMissedWalk] = useState(false);

      // Weather
      const [hourlyWeather, setHourlyWeather] = useState([]);
      const [weeklyWeather, setWeeklyWeather] = useState([]);
      const [weatherLoading, setWeatherLoading] = useState(true);
      const [locationError, setLocationError] = useState(false);

      // Check-in
      const [scheduledWalk, setScheduledWalk] = useState(null);
      const [checkInVisible, setCheckInVisible] = useState(false);
      const [checkInResult, setCheckInResult] = useState(null);

      // Show install prompt after delay on mobile
      useEffect(() => {
        const dismissed = localStorage.getItem("stepout_install_dismissed");
        if (!dismissed) {
          const timer = setTimeout(() => setShowInstall(true), 5000);
          return () => clearTimeout(timer);
        }
      }, []);

      // Load user data
      useEffect(() => {
        async function loadData() {
          // Try Firestore first, then localStorage
          let data = null;
          if (user.provider !== "offline") {
            data = await loadUserData(user.uid);
          }
          if (!data) {
            const local = localStorage.getItem("stepout_data_" + user.uid);
            if (local) data = JSON.parse(local);
          }
          if (data) {
            if (data.streak) setStreak(data.streak);
            if (data.weekLog) setWeekLog(data.weekLog);
            if (data.weeklyMins) setWeeklyMins(data.weeklyMins);
            if (data.duration) setDuration(data.duration);
          }
        }
        loadData();
      }, [user]);

      // Save data when it changes
      useEffect(() => {
        const data = { streak, weekLog, weeklyMins, duration, lastUpdated: new Date().toISOString() };
        localStorage.setItem("stepout_data_" + user.uid, JSON.stringify(data));
        if (user.provider !== "offline") {
          saveUserData(user.uid, data);
        }
      }, [streak, weekLog, weeklyMins, duration]);

      // Fetch weather
      useEffect(() => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (pos) => {
              const lat = pos.coords.latitude.toFixed(4);
              const lon = pos.coords.longitude.toFixed(4);
              const weatherData = await fetchWeather(lat, lon);
              if (weatherData && weatherData.hourly) {
                const now = new Date();
                const periods = weatherData.hourly.properties.periods || [];
                const todayHours = periods.filter(p => {
                  const d = new Date(p.startTime);
                  return d.getDate() === now.getDate() && d.getHours() >= 7 && d.getHours() <= 17;
                }).map(p => ({
                  time: new Date(p.startTime).toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" }),
                  temp: p.temperature,
                  condition: p.shortForecast,
                  icon: getWeatherIcon(p.shortForecast),
                  windMph: p.windSpeed ? parseInt(p.windSpeed) : 0,
                  good: isGoodWeather(p.shortForecast),
                }));
                setHourlyWeather(todayHours.length > 0 ? todayHours : getMockHourly());
              } else {
                setHourlyWeather(getMockHourly());
              }
              if (weatherData && weatherData.forecast) {
                const periods = weatherData.forecast.properties.periods || [];
                const days = periods.filter(p => p.isDaytime).slice(0, 7).map((p, i) => ({
                  day: (todayIdx + i) % 7,
                  high: p.temperature,
                  low: periods[i*2+1] ? periods[i*2+1].temperature : p.temperature - 15,
                  condition: p.shortForecast,
                  icon: getWeatherIcon(p.shortForecast),
                  good: isGoodWeather(p.shortForecast),
                }));
                setWeeklyWeather(days.length > 0 ? days : getMockWeekly());
              } else {
                setWeeklyWeather(getMockWeekly());
              }
              setWeatherLoading(false);
            },
            () => {
              setLocationError(true);
              setHourlyWeather(getMockHourly());
              setWeeklyWeather(getMockWeekly());
              setWeatherLoading(false);
            },
            { timeout: 10000 }
          );
        } else {
          setHourlyWeather(getMockHourly());
          setWeeklyWeather(getMockWeekly());
          setWeatherLoading(false);
        }
      }, []);

      function getMockHourly() {
        return [
          { time: "7:00 AM", temp: 52, condition: "Partly Cloudy", icon: "\u26C5", windMph: 4, good: true },
          { time: "8:00 AM", temp: 55, condition: "Sunny", icon: "\u2600\uFE0F", windMph: 3, good: true },
          { time: "9:00 AM", temp: 59, condition: "Sunny", icon: "\u2600\uFE0F", windMph: 5, good: true },
          { time: "10:00 AM", temp: 63, condition: "Sunny", icon: "\u2600\uFE0F", windMph: 6, good: true },
          { time: "11:00 AM", temp: 66, condition: "Partly Cloudy", icon: "\u26C5", windMph: 8, good: true },
          { time: "12:00 PM", temp: 68, condition: "Cloudy", icon: "\u2601\uFE0F", windMph: 10, good: true },
          { time: "1:00 PM", temp: 67, condition: "Rain", icon: "\u{1F327}\uFE0F", windMph: 15, good: false },
          { time: "2:00 PM", temp: 64, condition: "Rain", icon: "\u{1F327}\uFE0F", windMph: 18, good: false },
          { time: "3:00 PM", temp: 62, condition: "Cloudy", icon: "\u2601\uFE0F", windMph: 12, good: true },
          { time: "4:00 PM", temp: 60, condition: "Partly Cloudy", icon: "\u26C5", windMph: 7, good: true },
          { time: "5:00 PM", temp: 57, condition: "Clear", icon: "\u{1F305}", windMph: 4, good: true },
        ];
      }

      function getMockWeekly() {
        return [
          { day: 0, high: 62, low: 45, condition: "Sunny", icon: "\u2600\uFE0F", good: true },
          { day: 1, high: 58, low: 42, condition: "Partly Cloudy", icon: "\u26C5", good: true },
          { day: 2, high: 55, low: 40, condition: "Rain", icon: "\u{1F327}\uFE0F", good: false },
          { day: 3, high: 50, low: 38, condition: "Thunderstorms", icon: "\u26C8\uFE0F", good: false },
          { day: 4, high: 60, low: 43, condition: "Cloudy", icon: "\u2601\uFE0F", good: true },
          { day: 5, high: 65, low: 47, condition: "Sunny", icon: "\u2600\uFE0F", good: true },
          { day: 6, high: 63, low: 46, condition: "Partly Cloudy", icon: "\u26C5", good: true },
        ];
      }

      // Compute suggestions from hourly weather
      const suggestions = hourlyWeather.filter(w => w.good).map(w => ({
        time: w.time, weather: w, score: w.condition.includes("Sunny") ? 3 : 2, isOutdoor: true,
      })).concat(hourlyWeather.filter(w => !w.good).map(w => ({
        time: w.time, weather: w, score: 0, isOutdoor: false,
      }))).sort((a, b) => b.score - a.score);

      const bestOutdoor = suggestions.find(s => s.isOutdoor);

      useEffect(() => {
        setFadeIn(false);
        const t = setTimeout(() => setFadeIn(true), 50);
        return () => clearTimeout(t);
      }, [screen]);

      const streakMsg = STREAK_MESSAGES.find(s => streak >= s.min && streak <= s.max)?.msg || "";
      const currentMilestone = [...HEALTH_MILESTONES].reverse().find(m => weeklyMins >= m.mins);
      const nextMilestone = HEALTH_MILESTONES.find(m => m.mins > weeklyMins);
      const daysCompleted = Object.keys(weekLog).length;
      const progressPct = Math.round((daysCompleted / 7) * 100);

      function logActivity(type) {
        const newLog = { ...weekLog, [todayIdx]: type };
        setWeekLog(newLog);
        setWeeklyMins(prev => prev + duration);
        setStreak(prev => prev + 1);
        setMissedWalk(false);
        setCheckInVisible(false);
        setCheckInResult(type);
      }

      function scheduleWalk(slot) {
        // Create Google Calendar URL
        const now = new Date();
        const startHour = parseInt(slot.time);
        const isPM = slot.time.toLowerCase().includes("pm");
        let hour24 = isPM && startHour !== 12 ? startHour + 12 : startHour;
        if (!isPM && startHour === 12) hour24 = 0;

        const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour24, 0);
        const end = new Date(start.getTime() + duration * 60000);

        const fmt = d => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        const calUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(duration + "-Min StepOut Walk")}&dates=${fmt(start)}/${fmt(end)}&details=${encodeURIComponent("Your scheduled StepOut Daily walk. Get outside and move!")}`;

        window.open(calUrl, '_blank');
        setScheduledWalk({ time: slot.time, slot });
        setConfirmed(true);
      }

      function handleCheckIn(response) {
        if (response === "walk") { logActivity("walk"); setScreen("checkin_done"); }
        else if (response === "indoor") { setCheckInVisible(false); setIndoorActivity(getRandomActivity()); setScreen("indoor"); }
        else { setCheckInVisible(false); setMissedWalk(true); setScreen("home"); }
      }

      /* ─── STYLES ─── */
      const pillStyle = (active) => ({
        flex: 1, padding: "12px 0", borderRadius: 12, border: "none", cursor: "pointer",
        fontSize: 15, fontWeight: 600, fontFamily: "inherit",
        background: active ? "#86c26c" : "rgba(255,255,255,0.06)",
        color: active ? "#0a160a" : "#8a9a7e", transition: "all 0.2s ease",
      });

      const cardStyle = {
        background: "rgba(255,255,255,0.03)", border: "1px solid rgba(255,255,255,0.08)",
        borderRadius: 16, padding: "16px 18px", marginBottom: 12,
      };

      return (
        <div style={{
          maxWidth: 390, margin: "0 auto", minHeight: "100vh",
          background: "linear-gradient(170deg, #1a2e1a 0%, #0f1f0f 40%, #0a160a 100%)",
          fontFamily: "'Instrument Sans', 'Avenir Next', system-ui, sans-serif",
          color: "#e8efe4", position: "relative", overflow: "hidden",
        }}>
          <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet" />

          {/* Ambient glows */}
          <div style={{ position: "absolute", top: -80, right: -80, width: 260, height: 260, background: "radial-gradient(circle, rgba(134,194,108,0.12) 0%, transparent 70%)", borderRadius: "50%", pointerEvents: "none" }} />
          <div style={{ position: "absolute", bottom: 100, left: -60, width: 200, height: 200, background: "radial-gradient(circle, rgba(194,168,108,0.08) 0%, transparent 70%)", borderRadius: "50%", pointerEvents: "none" }} />

          <div style={{ opacity: fadeIn ? 1 : 0, transition: "opacity 0.3s ease", padding: "0 0 100px 0" }}>

            {/* ═══════════ HOME ═══════════ */}
            {screen === "home" && (
              <div style={{ padding: "56px 24px 24px" }}>
                {/* Header */}
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 20 }}>
                  <div>
                    <div style={{ fontSize: 13, letterSpacing: 2.5, textTransform: "uppercase", color: "#86c26c", fontWeight: 600, marginBottom: 4 }}>{dayName}</div>
                    <h1 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 34, fontWeight: 700, margin: 0, lineHeight: 1.1, color: "#f0f7ec" }}>
                      Step<span style={{ color: "#86c26c" }}>Out</span>
                    </h1>
                    <div style={{ fontSize: 14, color: "#8a9a7e", marginTop: 4 }}>{dateStr}</div>
                  </div>
                  <div style={{ display: "flex", gap: 8 }}>
                    <button onClick={() => setShowProfile(!showProfile)} style={{
                      background: "rgba(134,194,108,0.1)", border: "1px solid rgba(134,194,108,0.2)",
                      borderRadius: 12, width: 42, height: 42, display: "flex", alignItems: "center",
                      justifyContent: "center", cursor: "pointer", fontSize: 16, marginTop: 4,
                      color: "#86c26c",
                    }}>{user.name ? user.name.charAt(0).toUpperCase() : "\u{1F464}"}</button>
                  </div>
                </div>

                {/* Profile dropdown */}
                {showProfile && (
                  <div style={{
                    background: "rgba(20,35,20,0.95)", border: "1px solid rgba(134,194,108,0.2)",
                    borderRadius: 16, padding: 18, marginBottom: 20,
                    boxShadow: "0 8px 32px rgba(0,0,0,0.4)",
                  }}>
                    <div style={{ fontSize: 15, fontWeight: 600, color: "#e8efe4", marginBottom: 4 }}>{user.name || "User"}</div>
                    <div style={{ fontSize: 12, color: "#6b7a60", marginBottom: 14 }}>{user.email}</div>

                    <button onClick={() => setShowSettings(!showSettings)} style={{
                      width: "100%", padding: "10px 0", borderRadius: 10, cursor: "pointer",
                      background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.1)",
                      color: "#a8c89a", fontSize: 13, fontWeight: 600, fontFamily: "inherit", marginBottom: 8,
                    }}>{"\u2699\uFE0F"} Settings</button>

                    <button onClick={onLogout} style={{
                      width: "100%", padding: "10px 0", borderRadius: 10, cursor: "pointer",
                      background: "rgba(194,108,108,0.1)", border: "1px solid rgba(194,108,108,0.2)",
                      color: "#c27060", fontSize: 13, fontWeight: 600, fontFamily: "inherit",
                    }}>Sign Out</button>
                  </div>
                )}

                {/* Settings panel */}
                {showSettings && (
                  <div style={{
                    background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                    borderRadius: 16, padding: 20, marginBottom: 20,
                  }}>
                    <div style={{ fontSize: 13, fontWeight: 600, color: "#86c26c", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 14 }}>Walk Duration</div>
                    <div style={{ display: "flex", gap: 10 }}>
                      {[20, 30, 60].map(d => (
                        <button key={d} onClick={() => setDuration(d)} style={pillStyle(duration === d)}>{d} min</button>
                      ))}
                    </div>
                    <div style={{ fontSize: 12, color: "#6b7a60", marginTop: 10 }}>Currently set to {duration}-minute walks</div>
                  </div>
                )}

                {/* Streak + Progress */}
                <div style={{ display: "flex", gap: 12, marginBottom: 20 }}>
                  <div style={{
                    flex: 1, background: "linear-gradient(135deg, rgba(255,160,60,0.12) 0%, rgba(255,120,20,0.05) 100%)",
                    border: "1px solid rgba(255,160,60,0.2)", borderRadius: 16, padding: "16px 14px", textAlign: "center",
                  }}>
                    <div style={{ fontSize: 32, marginBottom: 2 }}>{"\u{1F525}"}</div>
                    <div style={{ fontSize: 28, fontWeight: 700, color: "#ffa03c", fontFamily: "'Playfair Display', serif" }}>{streak}</div>
                    <div style={{ fontSize: 11, color: "#c49a5c", fontWeight: 600, letterSpacing: 0.5 }}>Day Streak</div>
                  </div>
                  <div style={{
                    flex: 2, background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                    borderRadius: 16, padding: "14px 16px",
                  }}>
                    <div style={{ fontSize: 11, fontWeight: 600, color: "#6b7a60", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 10 }}>This Week</div>
                    <div style={{ display: "flex", gap: 6, marginBottom: 10 }}>
                      {DAYS.map((d, i) => {
                        const status = weekLog[i];
                        const isToday = i === todayIdx;
                        return (
                          <div key={i} style={{ flex: 1, textAlign: "center" }}>
                            <div style={{ fontSize: 10, color: isToday ? "#86c26c" : "#5a6a50", marginBottom: 4, fontWeight: isToday ? 700 : 400 }}>{d}</div>
                            <div style={{
                              width: 28, height: 28, borderRadius: "50%", margin: "0 auto",
                              display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13,
                              background: status === "walk" ? "rgba(134,194,108,0.25)" : status === "indoor" ? "rgba(194,168,108,0.25)" : isToday ? "rgba(255,255,255,0.08)" : "rgba(255,255,255,0.03)",
                              border: isToday ? "2px solid #86c26c" : "1px solid rgba(255,255,255,0.06)",
                            }}>
                              {status === "walk" ? "\u{1F6B6}" : status === "indoor" ? "\u{1F3E0}" : ""}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    <div style={{ height: 6, borderRadius: 3, background: "rgba(255,255,255,0.06)", overflow: "hidden" }}>
                      <div style={{
                        height: "100%", width: `${progressPct}%`, borderRadius: 3,
                        background: "linear-gradient(90deg, #86c26c, #a8d98a)", transition: "width 0.5s ease",
                      }} />
                    </div>
                    <div style={{ fontSize: 11, color: "#6b7a60", marginTop: 6 }}>{daysCompleted}/7 days active</div>
                  </div>
                </div>

                {/* Streak motivation */}
                <div style={{
                  background: "rgba(255,160,60,0.06)", border: "1px solid rgba(255,160,60,0.12)",
                  borderRadius: 12, padding: "10px 14px", marginBottom: 20, textAlign: "center",
                }}>
                  <div style={{ fontSize: 13, color: "#d4a860", fontStyle: "italic", fontFamily: "'Playfair Display', serif" }}>
                    "{streakMsg}"
                  </div>
                </div>

                {/* Health Impact */}
                <div style={{
                  background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                  borderRadius: 16, padding: 18, marginBottom: 20,
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#86c26c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 6 }}>
                    {"\u{1F9EC}"} Your Longevity Impact This Week
                  </div>
                  <div style={{ fontSize: 26, fontWeight: 700, color: "#e8efe4", fontFamily: "'Playfair Display', serif" }}>
                    {weeklyMins} minutes
                  </div>
                  {currentMilestone && <div style={{ fontSize: 13, color: "#a8c89a", marginTop: 4 }}>{"\u2705"} {currentMilestone.label}</div>}
                  {nextMilestone && <div style={{ fontSize: 12, color: "#6b7a60", marginTop: 6 }}>Next milestone: {nextMilestone.mins} min \u2014 {nextMilestone.mins - weeklyMins} min to go</div>}
                </div>

                {/* Missed walk banner */}
                {missedWalk && (
                  <div style={{
                    background: "linear-gradient(135deg, rgba(194,140,108,0.12) 0%, rgba(194,108,108,0.06) 100%)",
                    border: "1px solid rgba(194,140,108,0.25)", borderRadius: 16, padding: 18, marginBottom: 20,
                  }}>
                    <div style={{ fontSize: 13, fontWeight: 600, color: "#c2946c", marginBottom: 6 }}>
                      {"\u2600\uFE0F"} You missed your walk \u2014 no worries!
                    </div>
                    <div style={{ fontSize: 13, color: "#a89070", lineHeight: 1.5, marginBottom: 14 }}>
                      Don't break your streak. A quick indoor activity counts just as much for your body.
                    </div>
                    <button onClick={() => { setIndoorActivity(getRandomActivity()); setScreen("indoor"); }} style={{
                      width: "100%", padding: "14px 0", borderRadius: 12, border: "none", cursor: "pointer",
                      background: "linear-gradient(135deg, #c2946c 0%, #a87d52 100%)",
                      color: "#1a1008", fontSize: 14, fontWeight: 700, fontFamily: "inherit",
                    }}>
                      {"\u{1F3E0}"} Do an Indoor Activity Instead
                    </button>
                  </div>
                )}

                {/* Daily insight */}
                <div style={{
                  background: "rgba(194,168,108,0.08)", border: "1px solid rgba(194,168,108,0.15)",
                  borderRadius: 16, padding: 18, marginBottom: 20,
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#c2a86c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 8 }}>{"\u{1F4A1}"} Daily Longevity Insight</div>
                  <div style={{ fontFamily: "'Playfair Display', Georgia, serif", fontStyle: "italic", fontSize: 14.5, lineHeight: 1.5, color: "#d4c9a8" }}>
                    "{dailyQuote}"
                  </div>
                </div>

                {/* Hourly weather */}
                <div style={{ marginBottom: 24 }}>
                  <div style={{ fontSize: 13, fontWeight: 600, color: "#6b7a60", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 14 }}>
                    {weatherLoading ? "Loading Weather..." : locationError ? "Today's Weather (sample)" : "Today's Weather"}
                  </div>
                  <div style={{ display: "flex", gap: 6, overflowX: "auto", paddingBottom: 8, scrollbarWidth: "none" }}>
                    {hourlyWeather.map((w, i) => (
                      <div key={i} style={{
                        minWidth: 62, padding: "10px 6px", borderRadius: 14, textAlign: "center",
                        background: w.good ? "rgba(134,194,108,0.08)" : "rgba(194,108,108,0.08)",
                        border: `1px solid ${w.good ? "rgba(134,194,108,0.15)" : "rgba(194,108,108,0.15)"}`,
                      }}>
                        <div style={{ fontSize: 10, color: "#8a9a7e", marginBottom: 4 }}>{w.time.replace(":00 ", "").replace(" ", "").toLowerCase()}</div>
                        <div style={{ fontSize: 20, marginBottom: 2 }}>{w.icon}</div>
                        <div style={{ fontSize: 13, fontWeight: 600, color: "#e8efe4" }}>{w.temp}{"\u00B0"}</div>
                      </div>
                    ))}
                  </div>
                  {locationError && (
                    <div style={{ fontSize: 11, color: "#6b7a60", marginTop: 8 }}>
                      {"\u{1F4CD}"} Allow location access for your real local weather
                    </div>
                  )}
                </div>

                {/* Best time card */}
                {bestOutdoor && (
                  <div style={{ marginBottom: 20 }}>
                    <div style={{ fontSize: 13, fontWeight: 600, color: "#6b7a60", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 14 }}>{"\u2B50"} Best Time to Walk</div>
                    <button onClick={() => { setSelectedSlot(bestOutdoor); setScreen("detail"); }} style={{
                      width: "100%", background: "linear-gradient(135deg, rgba(134,194,108,0.15) 0%, rgba(134,194,108,0.05) 100%)",
                      border: "1px solid rgba(134,194,108,0.3)", borderRadius: 20, padding: 22,
                      cursor: "pointer", textAlign: "left", fontFamily: "inherit",
                    }}>
                      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                        <div>
                          <div style={{ fontSize: 28, fontWeight: 700, color: "#86c26c", fontFamily: "'Playfair Display', serif" }}>{bestOutdoor.time}</div>
                          <div style={{ fontSize: 14, color: "#b0c4a4", marginTop: 4 }}>
                            {bestOutdoor.weather.icon} {bestOutdoor.weather.temp}{"\u00B0"} {"\u00B7"} {bestOutdoor.weather.condition} {"\u00B7"} {duration} min walk
                          </div>
                        </div>
                        <div style={{ fontSize: 28, opacity: 0.6 }}>{"\u2192"}</div>
                      </div>
                    </button>
                  </div>
                )}

                {/* All slots */}
                <div>
                  <div style={{ fontSize: 13, fontWeight: 600, color: "#6b7a60", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 14 }}>All Available Slots</div>
                  <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                    {suggestions.slice(0, 6).map((s, i) => (
                      <button key={i} onClick={() => {
                        if (s.isOutdoor) { setSelectedSlot(s); setScreen("detail"); }
                        else { setIndoorActivity(getRandomActivity()); setScreen("indoor"); }
                      }} style={{
                        width: "100%", ...cardStyle, cursor: "pointer", textAlign: "left", fontFamily: "inherit",
                        display: "flex", justifyContent: "space-between", alignItems: "center",
                      }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                          <span style={{ fontSize: 22 }}>{s.weather.icon}</span>
                          <div>
                            <div style={{ fontSize: 15, fontWeight: 600, color: "#e8efe4" }}>{s.time}</div>
                            <div style={{ fontSize: 12, color: "#8a9a7e" }}>{s.weather.temp}{"\u00B0"} {"\u00B7"} {s.weather.condition}</div>
                          </div>
                        </div>
                        <div style={{
                          fontSize: 11, fontWeight: 600, padding: "4px 10px", borderRadius: 8,
                          background: s.isOutdoor ? "rgba(134,194,108,0.15)" : "rgba(194,140,108,0.15)",
                          color: s.isOutdoor ? "#86c26c" : "#c2946c",
                        }}>
                          {s.isOutdoor ? "Walk" : "Indoor"}
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* ═══════════ DETAIL ═══════════ */}
            {screen === "detail" && selectedSlot && (
              <div style={{ padding: "56px 24px 24px" }}>
                <button onClick={() => { setScreen("home"); setConfirmed(false); }} style={{
                  background: "none", border: "none", color: "#86c26c", fontSize: 14, fontWeight: 600,
                  cursor: "pointer", fontFamily: "inherit", padding: 0, marginBottom: 24,
                }}>{"\u2190"} Back</button>

                <div style={{ textAlign: "center", padding: "32px 0 24px" }}>
                  <div style={{ fontSize: 56, marginBottom: 12 }}>{selectedSlot.weather.icon}</div>
                  <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 32, fontWeight: 700, margin: 0, color: "#f0f7ec" }}>{selectedSlot.time}</h2>
                  <div style={{ fontSize: 16, color: "#8a9a7e", marginTop: 8 }}>
                    {selectedSlot.weather.temp}{"\u00B0"} {"\u00B7"} {selectedSlot.weather.condition} {"\u00B7"} Wind {selectedSlot.weather.windMph} mph
                  </div>
                </div>

                <div style={{
                  background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                  borderRadius: 20, padding: 24, marginBottom: 24,
                }}>
                  <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 16 }}>
                    <div>
                      <div style={{ fontSize: 12, color: "#6b7a60", textTransform: "uppercase", letterSpacing: 1 }}>Duration</div>
                      <div style={{ fontSize: 20, fontWeight: 700, color: "#e8efe4" }}>{duration} minutes</div>
                    </div>
                    <div style={{ textAlign: "right" }}>
                      <div style={{ fontSize: 12, color: "#6b7a60", textTransform: "uppercase", letterSpacing: 1 }}>Type</div>
                      <div style={{ fontSize: 20, fontWeight: 700, color: "#86c26c" }}>Outdoor Walk</div>
                    </div>
                  </div>
                  <div style={{ height: 1, background: "rgba(134,194,108,0.15)", margin: "0 0 16px" }} />
                  <div style={{ fontSize: 13, color: "#8a9a7e", lineHeight: 1.5 }}>
                    {"\u{1F33F}"} Perfect conditions for a {duration}-minute walk. {selectedSlot.weather.temp < 60 ? "Consider a light jacket." : "Enjoy the warmth!"} Remember to hydrate before heading out.
                  </div>
                </div>

                {/* Streak motivator */}
                <div style={{
                  background: "rgba(255,160,60,0.06)", border: "1px solid rgba(255,160,60,0.12)",
                  borderRadius: 12, padding: "12px 16px", marginBottom: 20, display: "flex", alignItems: "center", gap: 12,
                }}>
                  <span style={{ fontSize: 28 }}>{"\u{1F525}"}</span>
                  <div>
                    <div style={{ fontSize: 14, fontWeight: 700, color: "#ffa03c" }}>Keep your {streak}-day streak alive!</div>
                    <div style={{ fontSize: 12, color: "#a08050" }}>Scheduling this walk extends your streak to {streak + 1} days</div>
                  </div>
                </div>

                {!confirmed ? (
                  <div>
                    <button onClick={() => { scheduleWalk(selectedSlot); logActivity("walk"); }} style={{
                      width: "100%", padding: "18px 0", borderRadius: 16, border: "none",
                      background: "linear-gradient(135deg, #86c26c 0%, #6ba352 100%)",
                      color: "#0a160a", fontSize: 17, fontWeight: 700, cursor: "pointer",
                      fontFamily: "inherit", letterSpacing: 0.5,
                      boxShadow: "0 4px 24px rgba(134,194,108,0.3)", marginBottom: 10,
                    }}>
                      {"\u{1F4C5}"} Add to Google Calendar
                    </button>
                    <button onClick={() => { logActivity("walk"); setConfirmed(true); }} style={{
                      width: "100%", padding: "14px 0", borderRadius: 14, cursor: "pointer",
                      background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.1)",
                      color: "#a8c89a", fontSize: 14, fontWeight: 600, fontFamily: "inherit",
                    }}>
                      {"\u2705"} Just Log It (no calendar)
                    </button>
                  </div>
                ) : (
                  <div style={{
                    background: "rgba(134,194,108,0.1)", border: "1px solid rgba(134,194,108,0.3)",
                    borderRadius: 16, padding: 20, textAlign: "center",
                  }}>
                    <div style={{ fontSize: 36, marginBottom: 8 }}>{"\u2705"}</div>
                    <div style={{ fontSize: 17, fontWeight: 700, color: "#86c26c", marginBottom: 4 }}>Logged!</div>
                    <div style={{ fontSize: 13, color: "#8a9a7e" }}>"{duration}-Min Walk" at {selectedSlot.time}</div>
                    <div style={{ fontSize: 14, fontWeight: 600, color: "#ffa03c", marginTop: 10 }}>{"\u{1F525}"} Streak: {streak} days!</div>
                  </div>
                )}

                <div style={{
                  marginTop: 24, background: "rgba(194,168,108,0.08)", border: "1px solid rgba(194,168,108,0.15)",
                  borderRadius: 16, padding: 18,
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#c2a86c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 8 }}>{"\u{1F9EC}"} Longevity Tip</div>
                  <div style={{ fontSize: 13.5, lineHeight: 1.55, color: "#d4c9a8" }}>
                    Walking outdoors in natural light helps regulate your circadian rhythm, which governs everything from hormone production to cellular repair. Morning and late afternoon light are especially beneficial.
                  </div>
                </div>
              </div>
            )}

            {/* ═══════════ INDOOR ═══════════ */}
            {screen === "indoor" && (
              <div style={{ padding: "56px 24px 24px" }}>
                <button onClick={() => setScreen("home")} style={{
                  background: "none", border: "none", color: "#86c26c", fontSize: 14, fontWeight: 600,
                  cursor: "pointer", fontFamily: "inherit", padding: 0, marginBottom: 24,
                }}>{"\u2190"} Back</button>

                <div style={{ textAlign: "center", padding: "20px 0 28px" }}>
                  <div style={{ fontSize: 12, letterSpacing: 2.5, textTransform: "uppercase", color: "#c2946c", fontWeight: 600, marginBottom: 12 }}>
                    {"\u{1F327}\uFE0F"} Weather's Not Great \u2014 Stay Active Indoors
                  </div>
                  <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 28, fontWeight: 700, margin: 0, color: "#f0f7ec" }}>Indoor Activity</h2>
                </div>

                <div style={{
                  background: "rgba(255,160,60,0.06)", border: "1px solid rgba(255,160,60,0.12)",
                  borderRadius: 12, padding: "12px 16px", marginBottom: 20, display: "flex", alignItems: "center", gap: 12,
                }}>
                  <span style={{ fontSize: 28 }}>{"\u{1F525}"}</span>
                  <div>
                    <div style={{ fontSize: 14, fontWeight: 700, color: "#ffa03c" }}>Indoor days count too!</div>
                    <div style={{ fontSize: 12, color: "#a08050" }}>Complete this to keep your {streak}-day streak going</div>
                  </div>
                </div>

                <div style={{
                  background: "linear-gradient(135deg, rgba(194,140,108,0.1) 0%, rgba(194,140,108,0.03) 100%)",
                  border: "1px solid rgba(194,140,108,0.2)", borderRadius: 24, padding: 28,
                  textAlign: "center", marginBottom: 20,
                }}>
                  <div style={{ fontSize: 52, marginBottom: 12 }}>{indoorActivity.icon}</div>
                  <div style={{ fontSize: 22, fontWeight: 700, color: "#e8efe4", marginBottom: 6, fontFamily: "'Playfair Display', serif" }}>{indoorActivity.name}</div>
                  <div style={{
                    display: "inline-block", fontSize: 12, fontWeight: 600, padding: "4px 12px",
                    borderRadius: 8, background: "rgba(194,140,108,0.15)", color: "#c2946c",
                  }}>
                    ~{indoorActivity.duration} {"\u00B7"} No equipment needed
                  </div>
                  <div style={{
                    marginTop: 16, padding: "14px 16px", borderRadius: 12,
                    background: "rgba(255,255,255,0.04)", border: "1px solid rgba(255,255,255,0.08)", textAlign: "left",
                  }}>
                    <div style={{ fontSize: 11, fontWeight: 600, color: "#c2946c", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 6 }}>How To Do It</div>
                    <div style={{ fontSize: 13.5, lineHeight: 1.6, color: "#b0bca4" }}>{indoorActivity.howTo}</div>
                  </div>
                </div>

                <div style={{
                  background: "rgba(194,168,108,0.08)", border: "1px solid rgba(194,168,108,0.15)",
                  borderRadius: 16, padding: 18, marginBottom: 20,
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#c2a86c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 8 }}>{"\u{1F9EC}"} Why This Matters for Longevity</div>
                  <div style={{ fontSize: 13.5, lineHeight: 1.6, color: "#d4c9a8" }}>{indoorActivity.tip}</div>
                </div>

                <button onClick={() => setIndoorActivity(getRandomActivity())} style={{
                  width: "100%", padding: "16px 0", borderRadius: 14, cursor: "pointer",
                  background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.1)",
                  color: "#e8efe4", fontSize: 15, fontWeight: 600, fontFamily: "inherit", marginBottom: 10,
                }}>{"\u{1F504}"} Give Me a Different Activity</button>

                <button onClick={() => { logActivity("indoor"); setScreen("indoor_done"); }} style={{
                  width: "100%", padding: "16px 0", borderRadius: 14, cursor: "pointer",
                  background: "linear-gradient(135deg, #c2946c 0%, #a87d52 100%)",
                  border: "none", color: "#1a1008", fontSize: 15, fontWeight: 700, fontFamily: "inherit",
                  boxShadow: "0 4px 20px rgba(194,140,108,0.25)",
                }}>{"\u2705"} I Did This \u2014 Log It</button>
              </div>
            )}

            {/* ═══════════ INDOOR DONE ═══════════ */}
            {screen === "indoor_done" && (
              <div style={{ padding: "56px 24px 24px", textAlign: "center" }}>
                <div style={{ fontSize: 64, marginBottom: 16, marginTop: 40 }}>{"\u{1F389}"}</div>
                <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 28, fontWeight: 700, margin: "0 0 8px", color: "#f0f7ec" }}>Nice Work!</h2>
                <div style={{ fontSize: 16, color: "#8a9a7e", marginBottom: 24 }}>Your streak lives on.</div>
                <div style={{
                  background: "rgba(255,160,60,0.1)", border: "1px solid rgba(255,160,60,0.2)",
                  borderRadius: 20, padding: 24, marginBottom: 24,
                }}>
                  <div style={{ fontSize: 42, fontWeight: 700, color: "#ffa03c", fontFamily: "'Playfair Display', serif" }}>{"\u{1F525}"} {streak} days</div>
                  <div style={{ fontSize: 14, color: "#c49a5c", marginTop: 4 }}>{STREAK_MESSAGES.find(s => streak >= s.min && streak <= s.max)?.msg}</div>
                </div>
                <div style={{
                  background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                  borderRadius: 16, padding: 18, marginBottom: 24, textAlign: "left",
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#86c26c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 6 }}>Weekly Total</div>
                  <div style={{ fontSize: 24, fontWeight: 700, color: "#e8efe4", fontFamily: "'Playfair Display', serif" }}>{weeklyMins} minutes</div>
                  {currentMilestone && <div style={{ fontSize: 13, color: "#a8c89a", marginTop: 4 }}>{"\u2705"} {currentMilestone.label}</div>}
                </div>
                <button onClick={() => { setScreen("home"); setConfirmed(false); }} style={{
                  width: "100%", padding: "16px 0", borderRadius: 14, cursor: "pointer",
                  background: "linear-gradient(135deg, #86c26c 0%, #6ba352 100%)",
                  border: "none", color: "#0a160a", fontSize: 15, fontWeight: 700, fontFamily: "inherit",
                }}>{"\u2190"} Back to Home</button>
              </div>
            )}

            {/* ═══════════ CHECK-IN DONE ═══════════ */}
            {screen === "checkin_done" && (
              <div style={{ padding: "56px 24px 24px", textAlign: "center" }}>
                <div style={{ fontSize: 64, marginBottom: 16, marginTop: 40 }}>{"\u{1F6B6}\u200D\u2640\uFE0F"}</div>
                <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 28, fontWeight: 700, margin: "0 0 8px", color: "#f0f7ec" }}>Way to Go!</h2>
                <div style={{ fontSize: 16, color: "#8a9a7e", marginBottom: 8 }}>Walk logged \u2014 {duration} minutes in the books.</div>
                <div style={{
                  background: "rgba(255,160,60,0.1)", border: "1px solid rgba(255,160,60,0.2)",
                  borderRadius: 20, padding: 24, marginBottom: 20, marginTop: 24,
                }}>
                  <div style={{ fontSize: 42, fontWeight: 700, color: "#ffa03c", fontFamily: "'Playfair Display', serif" }}>{"\u{1F525}"} {streak} days</div>
                  <div style={{ fontSize: 14, color: "#c49a5c", marginTop: 4 }}>{STREAK_MESSAGES.find(s => streak >= s.min && streak <= s.max)?.msg}</div>
                </div>
                <div style={{
                  background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                  borderRadius: 16, padding: 18, marginBottom: 20, textAlign: "left",
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#86c26c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 6 }}>Weekly Total</div>
                  <div style={{ fontSize: 24, fontWeight: 700, color: "#e8efe4", fontFamily: "'Playfair Display', serif" }}>{weeklyMins} minutes</div>
                  {currentMilestone && <div style={{ fontSize: 13, color: "#a8c89a", marginTop: 4 }}>{"\u2705"} {currentMilestone.label}</div>}
                  {nextMilestone && <div style={{ fontSize: 12, color: "#6b7a60", marginTop: 6 }}>Next: {nextMilestone.mins} min \u2014 {nextMilestone.mins - weeklyMins} min to go</div>}
                </div>
                <button onClick={() => { setScreen("home"); setConfirmed(false); }} style={{
                  width: "100%", padding: "16px 0", borderRadius: 14, cursor: "pointer",
                  background: "linear-gradient(135deg, #86c26c 0%, #6ba352 100%)",
                  border: "none", color: "#0a160a", fontSize: 15, fontWeight: 700, fontFamily: "inherit",
                }}>{"\u2190"} Back to Home</button>
              </div>
            )}

            {/* ═══════════ WEEKLY PLAN ═══════════ */}
            {screen === "week" && (
              <div style={{ padding: "56px 24px 24px" }}>
                <div style={{ marginBottom: 24 }}>
                  <div style={{ fontSize: 13, letterSpacing: 2.5, textTransform: "uppercase", color: "#86c26c", fontWeight: 600, marginBottom: 4 }}>Plan Ahead</div>
                  <h2 style={{ fontFamily: "'Playfair Display', Georgia, serif", fontSize: 28, fontWeight: 700, margin: 0, color: "#f0f7ec" }}>Your Week</h2>
                </div>

                <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                  {weeklyWeather.map((w, idx) => {
                    const dayOffset = idx;
                    const isToday = dayOffset === 0;
                    const logged = weekLog[(todayIdx + idx) % 7];

                    return (
                      <div key={idx} style={{
                        ...cardStyle,
                        background: isToday ? "rgba(134,194,108,0.08)" : cardStyle.background,
                        border: isToday ? "1px solid rgba(134,194,108,0.25)" : cardStyle.border,
                      }}>
                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                          <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
                            <div style={{ textAlign: "center", minWidth: 44 }}>
                              <div style={{ fontSize: 24 }}>{w.icon}</div>
                              <div style={{ fontSize: 11, color: "#6b7a60", marginTop: 2 }}>{w.high}{"\u00B0"}/{w.low}{"\u00B0"}</div>
                            </div>
                            <div>
                              <div style={{ fontSize: 15, fontWeight: 600, color: "#e8efe4" }}>
                                {isToday ? "Today" : FULL_DAYS[(todayIdx + idx) % 7]}
                              </div>
                              <div style={{ fontSize: 12, color: "#8a9a7e" }}>{w.condition}</div>
                            </div>
                          </div>
                          <div>
                            {logged ? (
                              <div style={{
                                fontSize: 11, fontWeight: 600, padding: "4px 10px", borderRadius: 8,
                                background: "rgba(134,194,108,0.2)", color: "#86c26c",
                              }}>{"\u2713"} Done</div>
                            ) : w.good ? (
                              <div style={{
                                fontSize: 11, fontWeight: 600, padding: "4px 10px", borderRadius: 8,
                                background: "rgba(134,194,108,0.1)", color: "#86c26c",
                              }}>{"\u{1F6B6}"} Walk</div>
                            ) : (
                              <div style={{
                                fontSize: 11, fontWeight: 600, padding: "4px 10px", borderRadius: 8,
                                background: "rgba(194,140,108,0.1)", color: "#c2946c",
                              }}>{"\u{1F3E0}"} Indoor</div>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                <div style={{
                  marginTop: 20, background: "rgba(134,194,108,0.06)", border: "1px solid rgba(134,194,108,0.15)",
                  borderRadius: 16, padding: 18, textAlign: "center",
                }}>
                  <div style={{ fontSize: 11, fontWeight: 600, color: "#86c26c", letterSpacing: 2, textTransform: "uppercase", marginBottom: 6 }}>Week at a Glance</div>
                  <div style={{ fontSize: 14, color: "#a8c89a", lineHeight: 1.5 }}>
                    {weeklyWeather.filter(w => w.good).length} outdoor days {"\u00B7"} {weeklyWeather.filter(w => !w.good).length} indoor days planned
                  </div>
                  <div style={{ fontSize: 13, color: "#6b7a60", marginTop: 4 }}>
                    Complete every day for {weeklyWeather.length * duration} minutes this week
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* ═══════════ BOTTOM NAV ═══════════ */}
          <div style={{
            position: "fixed", bottom: 0, left: "50%", transform: "translateX(-50%)",
            width: "100%", maxWidth: 390, padding: "12px 24px 28px",
            background: "linear-gradient(to top, #0a160a 60%, transparent)",
            display: "flex", justifyContent: "space-around", zIndex: 50,
          }}>
            {[
              { icon: "\u{1F3E0}", label: "Today", s: "home" },
              { icon: "\u{1F4C5}", label: "Week", s: "week" },
              { icon: "\u{1F3C3}", label: "Indoor", s: "indoor" },
            ].map((item, i) => (
              <button key={i} onClick={() => {
                if (item.s === "indoor") setIndoorActivity(getRandomActivity());
                setScreen(item.s);
                setConfirmed(false);
                setShowProfile(false);
              }} style={{
                background: "none", border: "none", cursor: "pointer", textAlign: "center", padding: "6px 16px",
              }}>
                <div style={{ fontSize: 22, marginBottom: 2 }}>{item.icon}</div>
                <div style={{
                  fontSize: 10, fontWeight: 600, letterSpacing: 0.5,
                  color: (screen === item.s || (item.s === "home" && (screen === "detail" || screen === "indoor_done" || screen === "checkin_done"))) ? "#86c26c" : "#4a5a40",
                }}>{item.label}</div>
              </button>
            ))}
          </div>

          {/* Install prompt */}
          {showInstall && <InstallPrompt onDismiss={() => { setShowInstall(false); localStorage.setItem("stepout_install_dismissed", "true"); }} />}
        </div>
      );
    }

    /* ═══════════════════════════════════════════
       ROOT APP (handles auth state)
    ═══════════════════════════════════════════ */
    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        // Check for existing session
        if (firebaseReady && auth) {
          auth.onAuthStateChanged((firebaseUser) => {
            if (firebaseUser) {
              setUser({
                uid: firebaseUser.uid,
                email: firebaseUser.email,
                name: firebaseUser.displayName || firebaseUser.email,
                provider: firebaseUser.providerData[0]?.providerId === "google.com" ? "google" : "email"
              });
            }
            setLoading(false);
          });
        } else {
          // Check localStorage for offline user
          const saved = localStorage.getItem("stepout_user");
          if (saved) {
            try { setUser(JSON.parse(saved)); } catch(e) {}
          }
          setLoading(false);
        }
      }, []);

      function handleLogin(userData) {
        setUser(userData);
        localStorage.setItem("stepout_user", JSON.stringify(userData));
      }

      function handleLogout() {
        if (firebaseReady && auth) {
          auth.signOut().catch(e => console.log("Sign out error:", e.message));
        }
        localStorage.removeItem("stepout_user");
        setUser(null);
      }

      if (loading) {
        return (
          <div style={{
            maxWidth: 390, margin: "0 auto", minHeight: "100vh",
            background: "linear-gradient(170deg, #1a2e1a 0%, #0f1f0f 40%, #0a160a 100%)",
            display: "flex", alignItems: "center", justifyContent: "center",
            fontFamily: "'Instrument Sans', system-ui, sans-serif",
          }}>
            <div style={{ textAlign: "center" }}>
              <div style={{ fontSize: 48, marginBottom: 16 }}>{"\u{1F6B6}\u200D\u2640\uFE0F"}</div>
              <div style={{ color: "#86c26c", fontSize: 16, fontWeight: 600 }}>Loading...</div>
            </div>
          </div>
        );
      }

      if (!user) {
        return <WelcomeScreen onLogin={handleLogin} />;
      }

      return <StepOutApp user={user} onLogout={handleLogout} />;
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
